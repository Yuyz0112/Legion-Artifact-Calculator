var width=740;var height=635;function makeSVG(p,j,x){var x=x;var q=d3.select(j).append("svg").attr("width",width).attr("height",height);var c=q.selectAll("line").data(p.Links).enter().append("line").attr("class","link").attr("x1",function(B,A){return p.Powers[p.Links[A][0]].X}).attr("y1",function(B,A){return p.Powers[p.Links[A][0]].Y}).attr("x2",function(B,A){return p.Powers[p.Links[A][1]].X}).attr("y2",function(B,A){return p.Powers[p.Links[A][1]].Y}).attr("data-from",function(B,A){return B[0]}).attr("data-to",function(B,A){return B[1]});var a=Object.keys(p.Powers);var h=q.selectAll(".border").data(a).enter().append("image").attr("width",function(i){if(p.Powers[i].Border==1){return 88}else{if(p.Powers[i].Border==2){return 92}else{return 60}}}).attr("class",function(i){if(p.Powers[i].Border==2){return"active"}else{return"border"}}).attr("id",function(B,A){return"border"+B}).attr("height",function(i){if(p.Powers[i].Border==1){return 88}else{if(p.Powers[i].Border==2){return 92}else{return 60}}}).attr("x",function(i){if(p.Powers[i].Border==1){return p.Powers[i].X-44}else{if(p.Powers[i].Border==2){return p.Powers[i].X-46}else{return p.Powers[i].X-30}}}).attr("y",function(i){if(p.Powers[i].Border==1){return p.Powers[i].Y-44}else{if(p.Powers[i].Border==2){return p.Powers[i].Y-46}else{return p.Powers[i].Y-30}}}).attr("xlink:href",function(i){if(p.Powers[i].Border==1){return"http://www.myriptide.com/artifact-simulator/img/dragon_border.png"}else{if(p.Powers[i].Border==2){return"http://www.myriptide.com/artifact-simulator/img/start_border.png"}else{return"http://www.myriptide.com/artifact-simulator/img/normal_border.png"}}});var u=function(){var i=u.caller;while(i.caller){i=i.caller}return i.arguments[0]};__defineGetter__("event",u);var f=q.selectAll("circle").data(a).enter().append("circle").attr("r",20).attr("cx",function(i){return p.Powers[i].X}).attr("class",function(i){if(p.Powers[i].Border==2){return"active"}else{return"power"}}).attr("id",function(B,A){return"power"+B}).attr("cy",function(i){return p.Powers[i].Y}).attr("fill",function(i){return"url(#pattern"+i+")"}).style("cursor","pointer").on("mousedown",function(B,A){if(d3.select(this).attr("class")=="active"||d3.select(this).attr("data-role")=="unlocked"){n(event,B,A)}}).on("mouseover",function(C,A){var B=p.Powers[C].Desc[l[A]];if(l[A]>=p.Powers[C].MaxRank){B=p.Powers[C].Desc[p.Powers[C].MaxRank]}g.html("<h3>"+p.Powers[C].Title+"</h3><br/>"+B).style("left",(d3.event.pageX)-100+"px").style("top",(d3.event.pageY+50)+"px").style("display","block")}).on("mousemove",function(i){g.style("left",(d3.event.pageX)-100+"px").style("top",(d3.event.pageY+50)+"px")}).on("mouseout",function(i){g.style("display","none")});var m=40;var w=40;var d=q.selectAll("defs").data(a).enter().append("defs").append("pattern").attr("id",function(i){return"pattern"+i}).attr("patternUnits","userSpaceOnUse").attr("width",40).attr("height",40).attr("x",function(i){return p.Powers[i].X-20}).attr("y",function(i){return p.Powers[i].Y-20}).append("image").attr("width",m).attr("height",w).attr("xlink:href",function(i){return"http://www.myriptide.com/artifact-simulator/img/"+spells[p.Powers[i].Spell]+".jpg"});var b=q.selectAll(".rankHolders").data(a).enter().append("rect").attr("x",function(i){return p.Powers[i].X-20}).attr("y",function(i){return p.Powers[i].Y+20}).attr("width",40).attr("height",20).attr("fill","#212121");var l=new Array(a.length);for(var t=0;t<l.length;t++){l[t]=0}var z=new Array(a.length);var s=new Array(a.length);var r=q.selectAll(".rankText").data(a).enter().append("text").attr("class","rankText").attr("x",function(i){return p.Powers[i].X}).attr("y",function(i){return p.Powers[i].Y}).attr("dx",-10).attr("dy",35).text(function(B,A){return l[A]+"/"+p.Powers[B].MaxRank}).attr("id",function(B,A){return"rank"+B}).style("font-weight","bold").style("fill","#fff").style("font-size","14px");var g=d3.select(".page-container").append("div").attr("class","tooltip").style("display","none");document.oncontextmenu=stop;function n(D,G,B){e=D;var F=D.button;var E;var C;if(l[B]<p.Powers[G].MaxRank&&F==0){d3.select(j).select("#power"+G).attr("class","active");d3.select(j).select("#border"+G).attr("class","active");if(l[B]>p.Powers[G].MaxRank-2){E=p.Powers[G].Desc[p.Powers[G].MaxRank];C=true;s[B]=G}else{E=p.Powers[G].Desc[l[B]+1];C=false}g.html("<h3>"+p.Powers[G].Title+"</h3><br/>"+E);l[B]+=1;z[B]=G;c.attr("",function(J,I){for(var H=0;H<a.length;H++){if(J[0]==z[H]){if(C){d3.select(j).select("#power"+J[1]).attr("class","active").attr("data-role","unlocked");d3.select(j).select("#border"+J[1]).attr("class","active").attr("data-role","unlocked")}}else{if(J[1]==z[H]){d3.select(j).select("#power"+J[0]).attr("class","active");d3.select(j).select("#border"+J[0]).attr("class","active")}}}});v(s)}if(l[B]>0&&F==2){if(G==a[0]){o(p,j,x)}else{s[B]="";if(l[B]>2+p.Powers[G].MaxRank){E=p.Powers[G].Desc[p.Powers[G].MaxRank]}else{E=p.Powers[G].Desc[l[B]-1]}g.html("<h3>"+p.Powers[G].Title+"</h3><br/>"+E);l[B]-=1;var A=G;if(l[B]==0){if(p.Powers[G].Border!=2&&d3.select(j).select("#power"+G).attr("data-role")!="unlocked"){d3.select(j).select("#power"+G).attr("class","power");d3.select(j).select("#border"+G).attr("class","border")}}k(s,z,G,B);v(s)}}r.text(function(I,H){return l[H]+"/"+p.Powers[I].MaxRank});r.style("fill",function(I,H){if(l[H]>0){return"#2fc989"}else{return"#fff"}})}function k(D,A,E,C){f.attr("",function(M,K){var F=M;var J=K;var L=true;var H;var G;c.attr("data-init",function(O,N){if(F==O[0]){if(y(O[1])){L=false;H=true}}else{if(F==O[1]&&L){if(y(O[0])){G=true}}}});if(!H&&!G){for(var I=1;I<D.length;I++){if(I==J){D[I]="";l[I]=0;A[I]=""}}}});for(var C=0;C<A.length;C++){if(!A[C]){var B=C+parseInt(a[0]);d3.select(j).select("#power"+B).attr("class","power").attr("data-role","");d3.select(j).select("#border"+B).attr("class","border").attr("data-role","");if(l[0]){c.attr("",function(G,F){if(G[0]==A[0]){d3.select(j).select("#power"+G[1]).attr("class","active").attr("data-role","unlocked");d3.select(j).select("#border"+G[1]).attr("class","active").attr("data-role","unlocked")}})}}}}function y(B){for(var A=0;A<s.length;A++){if(B==s[A]){return true}}}function v(i){c.style("stroke",function(C,B){for(var A=0;A<i.length;A++){if(C[0]==i[A]||C[1]==i[A]){return x}}}).style("opacity",function(C,B){for(var A=0;A<i.length;A++){if(C[0]==i[A]||C[1]==i[A]){return 1}}})}function o(D,E,A){document.querySelector(E).innerHTML="";var C=document.querySelectorAll(".tooltip");for(var B=0;B<C.length;B++){C[B].style.display="none"}makeSVG(D,E,A)}}function stop(){return false};